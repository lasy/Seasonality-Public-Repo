sex = seasonal_analysis$time_series$seasonal_trend + seasonal_analysis$time_series$remainder)
ggplot(input_daily, aes(x = time, y = sex)) + geom_line()
input_daily = data.frame(time = seasonal_analysis$time_series$time,
date = seasonal_analysis$time_series$date ,
sex = seasonal_analysis$time_series$seasonal_trend + seasonal_analysis$time_series$remainder)
ggplot(input_daily, aes(x = time, y = sex)) + geom_line()
head(month(input_daily$date))
table(month(input_daily$date))
table(round_date(input_daily$date, unit = "month"))
?round_date
table(floor_date(input_daily$date, unit = "month"))
input_daily$date_m = floor_date(input_daily$date, unit = "month")
agg = aggregate(sex ~ date_m,input_daily, sum)
head(agg)
input_monthly = aggregate(sex ~ date_m,input_daily, sum)
ggplot(input_monthly, aes(x = date_m, y = sex)) + geom_line()
ggplot(input_monthly, aes(x = date_m, y = sex)) + geom_line() + geom_hline(yintercept = 0, linetype = 2)
input_monthly$time = year(input_monthly$date_m) + (month(input_monthly)-1)/12
input_monthly$time = year(input_monthly$date_m) + (month(input_monthly$date_m)-1)/12
table(input_monthly$time)
input_monthly$time
ggplot(input_monthly, aes(x = time, y = sex)) + geom_line() + geom_hline(yintercept = 0, linetype = 2)
ggplot(input_monthly, aes(x = date_m, y = sex)) + geom_line() + geom_hline(yintercept = 0, linetype = 2)
ggplot(input_monthly, aes(x = time, y = sex)) + geom_line() + geom_hline(yintercept = 0, linetype = 2)
head(input_monthly)
load(file = paste0(IO$out_Rdata,"UN_birth_data.Rdata"), verbose = TRUE)
head(birth)
unique(birth$Country.or.Area)
j = which((birth$Country.or.Area == "United States") & (birth$date %in% input_monthly$date_m))
j
birth[j,]
ggplot(birth[j,], aes(x = date, y = Value))
ggplot(birth[j,], aes(x = date, y = Value)) + geom_line()
LB = birth[j,]
ggplot(LB , aes(x = date, y = Value)) + geom_line()
LB$relative_value = LB$Value / mean(LB$Value)
ggplot(LB , aes(x = date, y = Value)) + geom_line() + expand_limits(y = 0)
ggplot(LB , aes(x = date, y = relative_value)) + geom_line()
LB$relative_value = LB$Value - mean(LB$Value)
ggplot(LB , aes(x = date, y = relative_value)) + geom_line()
date = intersect(input_monthly$date_m, LB$date)
date
date = unique(c(input_monthly$date_m, LB$date))
date = date[which((date %in% input_monthly$date_m)&(date %in% LB$date))]
date
input = merge(input_monthly, LB, by.x = date_m, by.y = date, all = FALSE)
input = merge(x= input_monthly, y = LB, by.x = "date_m", by.y = "date", all = FALSE)
dim(input)
dim(LB)
dim(input_monthly)
head(input_monthly)
colnames()
colnames(LB)
input = merge(
x= input_monthly[,c("date_m","time","sex")],
y = LB[,c("date","relative_value","Country.or.Area")],
by.x = "date_m", by.y = "date", all = FALSE)
Country.or.Area
input
input$n_sex = input$sex/max(input$sex)
var(input$sex)
max(input$sex)
sqrt(var(input$sex))
input$n_sex = input$sex/var(input$sex)
LB$rel_LB = LB$Value - mean(LB$Value)
input = merge(
x= input_monthly[,c("date_m","time","sex")],
y = LB[,c("date","rel_LB","Country.or.Area")],
by.x = "date_m", by.y = "date", all = FALSE)
input$sex_n = input$sex/var(input$sex)
input$rel_LB_n = input$rel_LB/var(input$rel_LB)
head(input)
input = merge(
x = LB[,c("date","rel_LB","Country.or.Area")],
y = input_monthly[,c("date_m","time","sex")],
by.x = "date", by.y = "date_m", all = FALSE)
# normalizing so that they have similar variance
input$sex_n = input$sex/var(input$sex)
input$rel_LB_n = input$rel_LB/var(input$rel_LB)
# normalizing so that they have similar variance
input$sex_n = input$sex/var(input$sex)
input$rel_LB_n = input$rel_LB/var(input$rel_LB)
ggplot(input, aes(x = date, y = sex_n))
ggplot(input, aes(x = date))+
geom_line(aes(y = rel_LB_n), col = "blue")+
geom_line(aes(y = sex_n), col = "red")
input$sex_n = input$sex/var(input$sex)
input$rel_LB_n = input$rel_LB/var(input$rel_LB)
ggplot(input, aes(x = date))+
geom_line(aes(y = rel_LB_n), col = "blue")+
geom_line(aes(y = sex_n), col = "red")
var(input$sex)
range(input$sex)
range(input$rel_LB_n)
input$sex_n = input$sex/sum(range(input$sex))
input$rel_LB_n = input$rel_LB/sum(range(input$rel_LB))
ggplot(input, aes(x = date))+
geom_line(aes(y = rel_LB_n), col = "blue")+
geom_line(aes(y = sex_n), col = "red")
input = merge(
x = LB[,c("date","rel_LB","Country.or.Area")],
y = input_monthly[,c("date_m","time","sex")],
by.x = "date", by.y = "date_m", all = TRUE)
# normalizing so that they have similar variance
input$sex_n = input$sex/sum(range(input$sex))
input$rel_LB_n = input$rel_LB/sum(range(input$rel_LB))
ggplot(input, aes(x = date))+
geom_line(aes(y = rel_LB_n), col = "blue")+
geom_line(aes(y = sex_n), col = "red")
dim(input)
# normalizing so that they have similar variance
input$sex_n = input$sex/sum(range(input$sex))
input$rel_LB_n = input$rel_LB/sum(range(input$rel_LB))
ggplot(input, aes(x = date))+
geom_line(aes(y = rel_LB_n), col = "blue")+
geom_line(aes(y = sex_n), col = "red")
input$sex_n = input$sex/sum(range(input$sex, na.rm = TRUE))
input$rel_LB_n = input$rel_LB/sum(range(input$rel_LB, na.rm = TRUE))
ggplot(input, aes(x = date))+
geom_line(aes(y = rel_LB_n), col = "blue")+
geom_line(aes(y = sex_n), col = "red")
input$date_time_shifted = input$date %m+% months(9)
head(
input$date_time_shifted)
head(
input$date_time_shifted)
40/4
input$date_time_shifted = input$date + lubridate::weeks(38)
head(
input$date_time_shifted )
input$date_shifted = input$date + lubridate::weeks(38)
input$sex_n_shifted = input$sex_n[match(input$date_shifted,input$date)]
input$sex_n_shifted
match(input$date_shifted,input$date)
38/4
input$date_shifted = input$date + lubridate::month(9)
input$sex_n_shifted = input$sex_n[match(input$date_shifted,input$date)]
input$sex_n_shifted
input$date_shifted = input$date + lubridate::month(9)
input$date_shifted
input$date
input$date_shifted = input$date %m+% lubridate::month(9)
input$date_shifted = input$date %m+% lubridate::months(9)
input$date_shifted = input$date %m+% months(9)
input$sex_n_shifted = input$sex_n[match(input$date_shifted,input$date)]
input$sex_n_shifted
ggplot(input, aes(x = date))+
geom_line(aes(y = rel_LB_n), col = "blue")+
geom_line(aes(y = sex_n), col = "red")
ggplot(input, aes(x = date))+
geom_line(aes(y = rel_LB_n), col = "blue")+
geom_line(aes(y = sex_n_shifted), col = "red")
ggplot(input, aes(x = date))+
geom_line(aes(y = rel_LB_n), col = "blue")+
geom_line(aes(y = sex_n), col = "red")
ggplot(input, aes(x = date))+
geom_line(aes(y = rel_LB_n), col = "blue")+
geom_line(aes(y = sex_n_shifted), col = "red")
input$date_shifted = input$date %m-% months(9)
input$sex_n_shifted = input$sex_n[match(input$date_shifted,input$date)]
ggplot(input, aes(x = date))+
geom_line(aes(y = rel_LB_n), col = "blue")+
geom_line(aes(y = sex_n), col = "red")
ggplot(input, aes(x = date))+
geom_line(aes(y = rel_LB_n), col = "blue")+
geom_line(aes(y = sex_n_shifted), col = "red")
ggplot(LB , aes(x = date, y = rel_LB)) + geom_line()
ggplot(input, aes(x = date))+
geom_line(aes(y = rel_LB), col = "blue")
ggplot(input, aes(x = date))+
geom_line(aes(y = rel_LB_n), col = "blue")
sum(range(input$rel_LB, na.rm = TRUE))
input$sex_n = input$sex/sum(abs(range(input$sex, na.rm = TRUE)))
input$rel_LB_n = input$rel_LB/sum(abs(range(input$rel_LB, na.rm = TRUE)))
ggplot(input, aes(x = date))+
geom_line(aes(y = rel_LB), col = "blue")
ggplot(input, aes(x = date))+
geom_line(aes(y = rel_LB_n), col = "blue")
ggplot(input, aes(x = date))+
geom_line(aes(y = rel_LB_n), col = "blue")+
geom_line(aes(y = sex_n), col = "red")
input$date_shifted = input$date %m-% months(9)
input$sex_n_shifted = input$sex_n[match(input$date_shifted,input$date)]
ggplot(input, aes(x = date))+
geom_line(aes(y = rel_LB_n), col = "blue")+
geom_line(aes(y = sex_n), col = "red")
ggplot(input, aes(x = date))+
geom_line(aes(y = rel_LB_n), col = "blue")+
geom_line(aes(y = sex_n_shifted), col = "red")
install.packages("digest")
install.packages("digest", type = "source")
?install.packages
install.packages("digest", type = "source")
install.packages("~/Downloads/digest_0.6.19.tgz", repos = NULL, type = .Platform$pkgType)
library(digest)
input_daily = data.frame(time = seasonal_analysis$time_series$time,
date = seasonal_analysis$time_series$date ,
sex = seasonal_analysis$time_series$seasonal_trend)
source("Scripts/00_setup.R")
load(file = paste0(IO$tmp_kindara, "seasonal_analysis_tot_sex.Rdata"), verbose = TRUE)
load(file = paste0(IO$out_Rdata,"UN_birth_data.Rdata"), verbose = TRUE)
input_daily = data.frame(time = seasonal_analysis$time_series$time,
date = seasonal_analysis$time_series$date ,
sex = seasonal_analysis$time_series$seasonal_trend)
ggplot(input_daily, aes(x = time, y = sex)) + geom_line()
input_daily$date_m = floor_date(input_daily$date, unit = "month")
input_monthly = aggregate(sex ~ date_m,input_daily, sum)
input_monthly$time = year(input_monthly$date_m) + (month(input_monthly$date_m)-1)/12
ggplot(input_monthly, aes(x = date_m, y = sex)) + geom_line() + geom_hline(yintercept = 0, linetype = 2)
#ggplot(input_monthly, aes(x = time, y = sex)) + geom_line() + geom_hline(yintercept = 0, linetype = 2)
input_daily_without_remainder = data.frame(time = seasonal_analysis$time_series$time,
date = seasonal_analysis$time_series$date ,
sex = seasonal_analysis$time_series$seasonal_trend )
input_daily_without_remainder = data.frame(time = seasonal_analysis$time_series$time,
date = seasonal_analysis$time_series$date ,
sex = seasonal_analysis$time_series$seasonal_trend )
ggplot(input_daily_without_remainder, aes(x = time, y = sex)) + geom_line()
input_daily_without_remainder = data.frame(time = seasonal_analysis$time_series$time,
date = seasonal_analysis$time_series$date ,
sex = seasonal_analysis$time_series$seasonal_trend )
ggplot(input_daily_without_remainder, aes(x = time, y = sex)) + geom_line()
input_daily_without_remainder$date_m = floor_date(input_daily_without_remainder$date, unit = "month")
input_monthly_without_remainder = aggregate(sex ~ date_m,input_daily_without_remainder, sum)
input_monthly_without_remainder$time = year(input_monthly_without_remainder$date_m) + (month(input_monthly_without_remainder$date_m)-1)/12
ggplot(input_monthly_without_remainder, aes(x = date_m, y = sex)) + geom_line() + geom_hline(yintercept = 0, linetype = 2) + geom_line(data = input_monthly, aes(x = date_m, y = sex), col = "blue")
input_daily = data.frame(time = seasonal_analysis$time_series$time,
date = seasonal_analysis$time_series$date ,
sex = seasonal_analysis$time_series$seasonal_trend + seasonal_analysis$time_series$remainder)
ggplot(input_daily, aes(x = time, y = sex)) + geom_line()
input_daily$date_m = floor_date(input_daily$date, unit = "month")
input_monthly = aggregate(sex ~ date_m,input_daily, sum)
input_monthly$time = year(input_monthly$date_m) + (month(input_monthly$date_m)-1)/12
ggplot(input_monthly, aes(x = date_m, y = sex)) + geom_line() + geom_hline(yintercept = 0, linetype = 2)
#ggplot(input_monthly, aes(x = time, y = sex)) + geom_line() + geom_hline(yintercept = 0, linetype = 2)
input_daily_without_remainder = data.frame(time = seasonal_analysis$time_series$time,
date = seasonal_analysis$time_series$date ,
sex = seasonal_analysis$time_series$seasonal_trend )
ggplot(input_daily_without_remainder, aes(x = time, y = sex)) + geom_line()
input_daily_without_remainder$date_m = floor_date(input_daily_without_remainder$date, unit = "month")
input_monthly_without_remainder = aggregate(sex ~ date_m,input_daily_without_remainder, sum)
input_monthly_without_remainder$time = year(input_monthly_without_remainder$date_m) + (month(input_monthly_without_remainder$date_m)-1)/12
ggplot(input_monthly_without_remainder, aes(x = date_m, y = sex)) + geom_line() + geom_hline(yintercept = 0, linetype = 2) + geom_line(data = input_monthly, aes(x = date_m, y = sex), col = "blue")
source('~/Google Drive/Ladies & Gentlemen/Papers/Seasonality/Seasonality-Public-Repo/Code/Scripts/00_functions.R')
load(paste0(IO$input_clue,"users_filtered.Rdata"), verbose = TRUE)
paste0(IO$input_clue,"users_filtered.Rdata")
load(paste0(IO$input_clue,"users_filtered.Rdata"), verbose = TRUE)
38*7/31
head(input_daily)
head(input)
input_daily = data.frame(time = seasonal_analysis$time_series$time,
date = seasonal_analysis$time_series$date ,
sex = seasonal_analysis$time_series$seasonal_trend + seasonal_analysis$time_series$remainder)
ggplot(input_daily, aes(x = time, y = sex)) + geom_line()
input_daily$date_m = floor_date(input_daily$date, unit = "month")
input_monthly = aggregate(sex ~ date_m,input_daily, sum)
input_monthly$time = year(input_monthly$date_m) + (month(input_monthly$date_m)-1)/12
ggplot(input_monthly, aes(x = date_m, y = sex)) + geom_line() + geom_hline(yintercept = 0, linetype = 2)
#ggplot(input_monthly, aes(x = time, y = sex)) + geom_line() + geom_hline(yintercept = 0, linetype = 2)
input_daily_without_remainder = data.frame(time = seasonal_analysis$time_series$time,
date = seasonal_analysis$time_series$date ,
sex = seasonal_analysis$time_series$seasonal_trend )
ggplot(input_daily_without_remainder, aes(x = time, y = sex)) + geom_line(col = "blue")
input_daily_without_remainder$date_m = floor_date(input_daily_without_remainder$date, unit = "month")
input_monthly_without_remainder = aggregate(sex ~ date_m,input_daily_without_remainder, sum)
input_monthly_without_remainder$time = year(input_monthly_without_remainder$date_m) + (month(input_monthly_without_remainder$date_m)-1)/12
ggplot(input_monthly_without_remainder, aes(x = date_m, y = sex)) + geom_line(col = "blue") + geom_hline(yintercept = 0, linetype = 2) + geom_line(data = input_monthly, aes(x = date_m, y = sex))
j = which((birth$Country.or.Area == "United States") & (birth$date %in% input_monthly$date_m))
LB = birth[j,]
ggplot(LB , aes(x = date, y = Value)) + geom_line() + expand_limits(y = 0)
LB$rel_LB = LB$Value - mean(LB$Value)
ggplot(LB , aes(x = date, y = rel_LB)) + geom_line()
input = merge(
x = LB[,c("date","rel_LB","Country.or.Area")],
y = input_monthly[,c("date_m","time","sex")],
by.x = "date", by.y = "date_m", all = TRUE)
# normalizing so that they have similar variance
input$sex_n = input$sex/sum(abs(range(input$sex, na.rm = TRUE)))
input$rel_LB_n = input$rel_LB/sum(abs(range(input$rel_LB, na.rm = TRUE)))
ggplot(input, aes(x = date))+
geom_line(aes(y = rel_LB), col = "blue")
ggplot(input, aes(x = date))+
geom_line(aes(y = rel_LB_n), col = "blue")
ggplot(input, aes(x = date))+
geom_line(aes(y = rel_LB_n), col = "blue")+
geom_line(aes(y = sex_n), col = "red")
input$date_shifted = input$date %m-% months(9)
input$sex_n_shifted = input$sex_n[match(input$date_shifted,input$date)]
input
input$month = c("J","F","M","A","M","J","J","A","S","O","N","D")[month(input$date)]
input$month
ggplot(input, aes(x = date))+
geom_line(aes(y = rel_LB_n), col = "blue")+
geom_text(aes(y = rel_LB_n, labels = month), col = "blue")+
geom_line(aes(y = sex_n_shifted), col = "red")
ggplot(input, aes(x = date))+
geom_line(aes(y = rel_LB_n), col = "blue")+
geom_text(aes(y = rel_LB_n, label = month), col = "blue")+
geom_line(aes(y = sex_n_shifted), col = "red")
ggplot(input, aes(x = date))+
geom_line(aes(y = rel_LB_n), col = "blue")+
geom_text(aes(y = rel_LB_n, label = month), col = "blue")+
geom_line(aes(y = sex_n_shifted), col = "red")
ggplot(input, aes(x = date))+
geom_line(aes(y = rel_LB_n), col = "blue")+
geom_text(aes(y = rel_LB_n, label = month), col = "blue")+
geom_line(aes(y = sex_n), col = "red")+
geom_text(aes(y = sex_n, label = month), col = "red")+
1
ggplot(input, aes(x = date))+
geom_line(aes(y = rel_LB_n), col = "blue")+
geom_text(aes(y = rel_LB_n, label = month), col = "blue")+
geom_line(aes(y = sex_n), col = "red")+
geom_text(aes(y = sex_n, label = month), col = "red")
ggplot(input, aes(x = date))+
geom_line(aes(y = rel_LB_n), col = "blue")+
geom_text(aes(y = rel_LB_n, label = month), col = "blue")+
geom_line(aes(y = sex_n_shifted), col = "red")
geom_text(aes(y = sex_n_shifted, label = month), col = "red")
ggplot(input, aes(x = date))+
geom_line(aes(y = rel_LB_n), col = "blue")+
geom_text(aes(y = rel_LB_n, label = month), col = "blue")+
geom_line(aes(y = sex_n_shifted), col = "red")
geom_text(aes(y = sex_n_shifted, label = month), col = "red")
ggplot(input, aes(x = date))+
geom_line(aes(y = rel_LB_n), col = "blue")+
geom_text(aes(y = rel_LB_n, label = month), col = "blue")+
geom_line(aes(y = sex_n_shifted), col = "red")+
geom_text(aes(y = sex_n_shifted, label = month), col = "red")
input$month_shifted = c("J","F","M","A","M","J","J","A","S","O","N","D")[month(input$date_shifted)]
ggplot(input, aes(x = date))+
geom_line(aes(y = rel_LB_n), col = "blue")+
geom_text(aes(y = rel_LB_n, label = month), col = "blue")+
geom_line(aes(y = sex_n_shifted), col = "red")+
geom_text(aes(y = sex_n_shifted, label = month_shifted), col = "red")
ggplot(birth[which(birth$Country.or.Area == "United States"),], aes(x = date, y = Value)) + geom_line()
ggplot(birth[which(birth$Country.or.Area == "United States"),], aes(x = date, y = Value)) +
geom_line()+
geom_point()
ggplot(birth[which(birth$Country.or.Area == "United States"),], aes(x = date, y = Value)) +
geom_line()+
geom_point(size = 0.5)
ggplot(birth[which(birth$Country.or.Area == "United States"),], aes(x = date, y = Value)) +
geom_line(col = "gray")+
geom_point(size = 0.5)
ggplot(birth[which((birth$Country.or.Area == "United States") & (birth$date >= as.Date("2011-01-01"))),], aes(x = date, y = Value)) +
geom_line(col = "gray")+
geom_point(size = 0.5)
head(
birth$Month)
birth$Month_short = substr(birth$Month, 1,3)
birth$Month_short
ggplot(birth[which((birth$Country.or.Area == "United States") & (birth$date >= as.Date("2011-01-01"))),],
aes(x = date, y = Value)) +
geom_line(col = "gray")+
geom_text(aes(y= Value * 1.2, label = Month_short))+
geom_point(size = 0.5)
ggplot(birth[which((birth$Country.or.Area == "United States") & (birth$date >= as.Date("2011-01-01"))),],
aes(x = date, y = Value)) +
geom_line(col = "gray")+
geom_text(aes(y= Value * 1.05, label = Month_short))+
geom_point(size = 0.5)
ggplot(birth[which((birth$Country.or.Area == "United States") & (birth$date >= as.Date("2011-01-01"))),],
aes(x = date, y = Value)) +
geom_line(col = "gray")+
geom_text(aes(y= Value, label = Month_short))+
geom_point(size = 0.5)
source("Scripts/00_setup.R")
load(file = paste0(IO$tmp_kindara, "seasonal_analysis_tot_sex.Rdata"), verbose = TRUE)
load(file = paste0(IO$out_Rdata,"UN_birth_data.Rdata"), verbose = TRUE)
input_daily = data.frame(time = seasonal_analysis$time_series$time,
date = seasonal_analysis$time_series$date ,
sex = seasonal_analysis$time_series$seasonal_trend + seasonal_analysis$time_series$remainder)
ggplot(input_daily, aes(x = time, y = sex)) + geom_line()
input_daily$date_m = floor_date(input_daily$date, unit = "month")
input_monthly = aggregate(sex ~ date_m,input_daily, sum)
input_monthly$time = year(input_monthly$date_m) + (month(input_monthly$date_m)-1)/12
ggplot(input_monthly, aes(x = date_m, y = sex)) + geom_line() + geom_hline(yintercept = 0, linetype = 2)
#ggplot(input_monthly, aes(x = time, y = sex)) + geom_line() + geom_hline(yintercept = 0, linetype = 2)
input_daily_without_remainder = data.frame(time = seasonal_analysis$time_series$time,
date = seasonal_analysis$time_series$date ,
sex = seasonal_analysis$time_series$seasonal_trend )
ggplot(input_daily_without_remainder, aes(x = time, y = sex)) + geom_line(col = "blue")
input_daily_without_remainder$date_m = floor_date(input_daily_without_remainder$date, unit = "month")
input_monthly_without_remainder = aggregate(sex ~ date_m,input_daily_without_remainder, sum)
input_monthly_without_remainder$time = year(input_monthly_without_remainder$date_m) + (month(input_monthly_without_remainder$date_m)-1)/12
ggplot(input_monthly_without_remainder, aes(x = date_m, y = sex)) + geom_line(col = "blue") + geom_hline(yintercept = 0, linetype = 2) + geom_line(data = input_monthly, aes(x = date_m, y = sex))
j = which((birth$Country.or.Area == "United States") & (birth$date %in% input_monthly$date_m))
ggplot(birth[which(birth$Country.or.Area == "United States"),], aes(x = date, y = Value)) +
geom_line(col = "gray")+
geom_point(size = 0.5)
birth$Month_short = substr(birth$Month, 1,3)
ggplot(birth[which((birth$Country.or.Area == "United States") & (birth$date >= as.Date("2011-01-01"))),],
aes(x = date, y = Value)) +
geom_line(col = "gray")+
geom_text(aes(y= Value, label = Month_short))+
geom_point(size = 0.5)
LB = birth[j,]
ggplot(LB , aes(x = date, y = Value)) + geom_line() + expand_limits(y = 0)
LB$rel_LB = LB$Value - mean(LB$Value)
ggplot(LB , aes(x = date, y = rel_LB)) + geom_line()
input = merge(
x = LB[,c("date","rel_LB","Country.or.Area")],
y = input_monthly[,c("date_m","time","sex")],
by.x = "date", by.y = "date_m", all = TRUE)
# normalizing so that they have similar variance
input$sex_n = input$sex/sum(abs(range(input$sex, na.rm = TRUE)))
input$rel_LB_n = input$rel_LB/sum(abs(range(input$rel_LB, na.rm = TRUE)))
ggplot(input, aes(x = date))+
geom_line(aes(y = rel_LB), col = "blue")
ggplot(input, aes(x = date))+
geom_line(aes(y = rel_LB_n), col = "blue")
ggplot(input, aes(x = date))+
geom_line(aes(y = rel_LB_n), col = "blue")+
geom_line(aes(y = sex_n), col = "red")
input$date_shifted = input$date %m-% months(9)
input$sex_n_shifted = input$sex_n[match(input$date_shifted,input$date)]
input$month = c("J","F","M","A","M","J","J","A","S","O","N","D")[month(input$date)]
input$month_shifted = c("J","F","M","A","M","J","J","A","S","O","N","D")[month(input$date_shifted)]
ggplot(input, aes(x = date))+
geom_line(aes(y = rel_LB_n), col = "blue")+
geom_text(aes(y = rel_LB_n, label = month), col = "blue")+
geom_line(aes(y = sex_n), col = "red")+
geom_text(aes(y = sex_n, label = month), col = "red")
ggplot(input, aes(x = date))+
geom_line(aes(y = rel_LB_n), col = "blue")+
geom_text(aes(y = rel_LB_n, label = month), col = "blue")+
geom_line(aes(y = sex_n_shifted), col = "red")+
geom_text(aes(y = sex_n_shifted, label = month_shifted), col = "red")
load(paste0(IO$tmp_kindara, "sk1.Rdata"), verbose = TRUE)
head(sk1)
mean(sk1$n_cycles)
head(seasonal_analysis$time_series)
hist(seasonal_analysis$time_series$remainder)
hist(seasonal_analysis$time_series$remainder, breaks = 100)
var(seasonal_analysis$time_series$remainder)
sqrt(var(seasonal_analysis$time_series$remainder))
var(seasonal_analysis$time_series$remainder)^2
summary(seasonal_analysis$time_series$remainder)
quantile(seasonal_analysis$time_series$remainder, p = c(0.05,0.95))
quantile(seasonal_analysis$time_series$remainder, p = c(0.05,0.99))
quantile(seasonal_analysis$time_series$remainder, p = c(0.05,0.98))
holidays = seasonal_analysis$time_series$date[seasonal_analysis$time_series$remainder >= 0.03]
holidays
holidays = seasonal_analysis$time_series$date[seasonal_analysis$time_series$remainder >= 0.025]
holidays
holidays = seasonal_analysis$time_series$date[seasonal_analysis$time_series$remainder >= 0.02]
holidays
holidays = seasonal_analysis$time_series$date[seasonal_analysis$time_series$remainder >= 0.02]
holidays
seasonal_analysis$time_series$remainder_without_holidays = seasonal_analysis$time_series$remainder
for(holiday in holidays){
j = which(seasonal_analysis$time_series$date == holiday)
seasonal_analysis$time_series$remainder_without_holidays[j] =
mean(seasonal_analysis$time_series$remainder[c(j-3,j-2,j-1,j+1,j+2,j+3)], na.rm = TRUE)
}
holiday = holidays[1]
holiday
j = which(seasonal_analysis$time_series$date == holiday)
j
j_around = max(1,j-3):min(j+3,nrow(seasonal_analysis$time_series))
j_around
setdiff(j_around, j)
j_around = setdiff(j_around, j)
mean(seasonal_analysis$time_series$remainder[j_around], na.rm = TRUE)
seasonal_analysis$time_series$remainder_without_holidays[j]
holidays = seasonal_analysis$time_series$date[seasonal_analysis$time_series$remainder >= 0.02]
holidays
seasonal_analysis$time_series$remainder_without_holidays = seasonal_analysis$time_series$remainder
for(holiday in holidays){
j = which(seasonal_analysis$time_series$date == holiday)
j_around = max(1,j-3):min(j+3,nrow(seasonal_analysis$time_series))
j_around = setdiff(j_around, j)
seasonal_analysis$time_series$remainder_without_holidays[j] =
mean(seasonal_analysis$time_series$remainder[j_around], na.rm = TRUE)
}
ggplot(seasonal_analysis$time_series, aes(x = date))+
geom_line(aes(y = remainder), col = "blue")+
geom_line(aes(y = remainder_without_holidays))
head(seasonal_analysis$time_series)
ggplot(seasonal_analysis$time_series[1:28,], aes(x = date, y = weekly_trend))+
geom_line()
ggplot(seasonal_analysis$time_series[1:28,], aes(x = date, y = weekly_trend))+
geom_line() + geom_point()
ggplot(seasonal_analysis$time_series[1:100,], aes(x = date))+
geom_line(aes(y = remainder), col = "blue")+
geom_line(aes(y = remainder_without_holidays))
ggplot(seasonal_analysis$time_series[1:200,], aes(x = date))+
geom_line(aes(y = remainder), col = "blue")+
geom_line(aes(y = remainder_without_holidays))
ggplot(seasonal_analysis$time_series[1:300,], aes(x = date))+
geom_line(aes(y = remainder), col = "blue")+
geom_line(aes(y = remainder_without_holidays))
input_daily_without_holiday = data.frame(time = seasonal_analysis$time_series$time,
date = seasonal_analysis$time_series$date ,
sex = seasonal_analysis$time_series$remainder_without_holidays )
ggplot(input_daily_without_holiday, aes(x = time, y = sex)) + geom_line(col = "blue")
input_daily_without_holiday$date_m = floor_date(input_daily_without_holiday$date, unit = "month")
input_monthly_without_remainder = aggregate(sex ~ date_m,input_daily_without_holiday, sum)
input_monthly_without_remainder$time = year(input_monthly_without_remainder$date_m) + (month(input_monthly_without_remainder$date_m)-1)/12
ggplot(input_monthly_without_remainder, aes(x = date_m, y = sex)) + geom_line(col = "blue") + geom_hline(yintercept = 0, linetype = 2) + geom_line(data = input_monthly, aes(x = date_m, y = sex))
ggplot(seasonal_analysis$time_series, aes(x = date))+
geom_line(aes(y = remainder), col = "blue")+
geom_line(aes(y = remainder_without_holidays))
input_daily_without_holiday = data.frame(time = seasonal_analysis$time_series$time,
date = seasonal_analysis$time_series$date ,
sex = seasonal_analysis$time_series$seasonal_trend+
seasonal_analysis$time_series$remainder_without_holidays )
ggplot(input_daily_without_holiday, aes(x = time, y = sex)) + geom_line(col = "blue")
input_daily_without_holiday$date_m = floor_date(input_daily_without_holiday$date, unit = "month")
input_monthly_without_remainder = aggregate(sex ~ date_m,input_daily_without_holiday, sum)
input_monthly_without_remainder$time = year(input_monthly_without_remainder$date_m) + (month(input_monthly_without_remainder$date_m)-1)/12
ggplot(input_monthly_without_remainder, aes(x = date_m, y = sex)) + geom_line(col = "blue") + geom_hline(yintercept = 0, linetype = 2) + geom_line(data = input_monthly, aes(x = date_m, y = sex))
